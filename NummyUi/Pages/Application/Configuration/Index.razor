@page "/application/configuration/{ApplicationId:guid}"
@using NummyUi.Components

<Card>
    <GridRow>
        <Title Level="2" Style="margin-bottom: 8px">Configurations</Title>
    </GridRow>
    <GridRow>
        <Text Type="TextElementType.Secondary" Style="color: #00A0E9">Manage Your application's package configurations
        </Text>
    </GridRow>
    <Divider/>
    @if (_application != null)
    {
        <GridRow>
            <Title Level="4" Style="margin: 20px 0 25px;">Application Details</Title>
        </GridRow>
        <GridRow>
            <Text Strong>Name</Text>
            <Input ReadOnly Value="@_application.Name" Style="margin-bottom: 15px; margin-top: 8px"/>
        </GridRow>
        <GridRow>
            <Text Strong>Description</Text>
            <TextArea ReadOnly Rows="3" Value="@_application.Description"
                      Style="margin-bottom: 15px; margin-top: 8px"></TextArea>
        </GridRow>
        <GridRow>
            <Text Strong>Created At</Text>
            <Input ReadOnly Value="@_application.CreatedAt" Style="margin-bottom: 15px; margin-top: 8px"/>
        </GridRow>
        <GridRow>
            <Text Strong>Stack</Text>
        </GridRow>
        <GridRow Style="display: flex; align-items: center; margin-bottom: 15px; margin-top: 8px;">
            <GridCol>
                <Avatar Shape="AvatarShape.Square"
                        Src="@("data:image/svg+xml;utf8," + Uri.EscapeDataString(_application.Stack.IconSvg))"
                        Size="@("2.3em")"
                        Style="margin-right: 10px">
                </Avatar>
            </GridCol>
            <GridCol>
                <Text>@_application.Stack.Title</Text>
            </GridCol>
        </GridRow>
        <Divider/>
        <GridRow>
            <Title Level="4" Style="margin: 20px 0 8px;">Application Code</Title>
        </GridRow>
        <GridRow>
            <Text Type="@TextElementType.Secondary" Style="margin-bottom: 20px">Copy the id and url below and paste it into your
                application to
                connect it with Nummy.
            </Text>
        </GridRow>
        <GridRow>
            <ApplicationConfigurationCard ApplicationId="@_application.Id.ToString()"/>
        </GridRow>
        <Divider/>
        <GridRow Style="margin-bottom: 20px; width: 100%;">
            <PackageCard Title="Nummy.ExceptionHandler"
                         Description="A .NET Core library for global exception handling in your application."
                         IconUrl="https://api.nuget.org/v3-flatcontainer/nummy.exceptionhandler/1.5.0/icon"
                         CurrentStep="ExceptionHandlerStep"
                         OnStepChange="onExceptionHandlerStepChange"
                         IsExpanded="_showEx"
                         BorderColor="red"
                         IsExpandedChanged="OnExceptionHandlerExpandedChanged">
                <StepsContent>
                    <Step Title="Install" Description="Install-Package Nummy.ExceptionHandler">
                        <DescriptionTemplate>
                            <Text>Run the following command in Package Manager Console:</Text>
                            <pre style="background: #f5f5f5; padding: 15px; border-radius: 4px; margin-top: 10px;">
Install-Package Nummy.ExceptionHandler</pre>
                        </DescriptionTemplate>
                    </Step>
                    <Step Title="Using" Description="using Nummy.ExceptionHandler.Extensions;">
                        <DescriptionTemplate>
                            <Text>Add the following using statement at the top of your Program.cs:</Text>
                            <pre style="background: #f5f5f5; padding: 15px; border-radius: 4px; margin-top: 10px;">
using Nummy.ExceptionHandler.Extensions;</pre>
                        </DescriptionTemplate>
                    </Step>
                    <Step Title="Configure" Description="Add services in Program.cs">
                        <DescriptionTemplate>
                            <Text>Add the following configuration in your Program.cs:</Text>
                            <pre style="background: #f5f5f5; padding: 15px; border-radius: 4px; margin-top: 10px;">
builder.Services.AddNummyExceptionHandler(options =>
                            {
                            options.HandleException = true;
                            options.Response = new { message = "An error occurred" };
                            options.ResponseStatusCode = HttpStatusCode.BadRequest;
                            options.ApplicaionId = "@_application.Id"
                            });</pre>
                        </DescriptionTemplate>
                    </Step>
                    <Step Title="Middleware" Description="Add middleware in Program.cs">
                        <DescriptionTemplate>
                            <Text>Add the following middleware in your Program.cs after building the app:</Text>
                            <pre style="background: #f5f5f5; padding: 15px; border-radius: 4px; margin-top: 10px;">
var app = builder.Build();
app.UseNummyExceptionHandler();</pre>
                        </DescriptionTemplate>
                    </Step>
                </StepsContent>
            </PackageCard>
        </GridRow>

        <GridRow Style="margin-bottom: 20px; width: 100%;">
            <PackageCard Title="Nummy.CodeLogger"
                         Description="A .NET Core library for code logging and monitoring."
                         IconUrl="https://api.nuget.org/v3-flatcontainer/nummy.codelogger/1.5.0/icon"
                         CurrentStep="CodeLoggerStep"
                         OnStepChange="onCodeLoggerStepChange"
                         IsExpanded="_showCodeLogger"
                         BorderColor="orange"
                         IsExpandedChanged="OnCodeLoggerExpandedChanged">
                <StepsContent>
                    <Step Title="Install" Description="Install-Package Nummy.CodeLogger">
                        <DescriptionTemplate>
                            <Text>Run the following command in Package Manager Console:</Text>
                            <pre style="background: #f5f5f5; padding: 15px; border-radius: 4px; margin-top: 10px;">
Install-Package Nummy.CodeLogger</pre>
                        </DescriptionTemplate>
                    </Step>
                    <Step Title="Using" Description="using Nummy.CodeLogger.Extensions;">
                        <DescriptionTemplate>
                            <Text>Add the following using statement at the top of your Program.cs:</Text>
                            <pre style="background: #f5f5f5; padding: 15px; border-radius: 4px; margin-top: 10px;">
using Nummy.CodeLogger.Extensions;</pre>
                        </DescriptionTemplate>
                    </Step>
                    <Step Title="Configure" Description="Add services in Program.cs">
                        <DescriptionTemplate>
                            <Text>Add the following configuration in your Program.cs:</Text>
                            <pre style="background: #f5f5f5; padding: 15px; border-radius: 4px; margin-top: 10px;">
builder.Services.AddNummyCodeLogger(options =>
                            {
                            options.ApplicationId = "@_application.Id";
                            options.EnableConsoleLogging = true;
                            });</pre>
                        </DescriptionTemplate>
                    </Step>
                    <Step Title="Middleware" Description="Add middleware in Program.cs">
                        <DescriptionTemplate>
                            <Text>Add the following middleware in your Program.cs after building the app:</Text>
                            <pre style="background: #f5f5f5; padding: 15px; border-radius: 4px; margin-top: 10px;">
var app = builder.Build();
app.UseNummyCodeLogger();</pre>
                        </DescriptionTemplate>
                    </Step>
                </StepsContent>
            </PackageCard>
        </GridRow>

        <GridRow Style="margin-bottom: 20px; width: 100%;">
            <PackageCard Title="Nummy.HttpLogger"
                         Description="A .NET Core library for HTTP request/response logging."
                         IconUrl="https://api.nuget.org/v3-flatcontainer/nummy.httplogger/1.5.0/icon"
                         CurrentStep="HttpLoggerStep"
                         OnStepChange="onHttpLoggerStepChange"
                         IsExpanded="_showHttpLogger"
                         BorderColor="green"
                         IsExpandedChanged="OnHttpLoggerExpandedChanged">
                <StepsContent>
                    <Step Title="Install" Description="Install-Package Nummy.HttpLogger">
                        <DescriptionTemplate>
                            <Text>Run the following command in Package Manager Console:</Text>
                            <pre style="background: #f5f5f5; padding: 15px; border-radius: 4px; margin-top: 10px;">
Install-Package Nummy.HttpLogger</pre>
                        </DescriptionTemplate>
                    </Step>
                    <Step Title="Using" Description="using Nummy.HttpLogger.Extensions;">
                        <DescriptionTemplate>
                            <Text>Add the following using statement at the top of your Program.cs:</Text>
                            <pre style="background: #f5f5f5; padding: 15px; border-radius: 4px; margin-top: 10px;">
using Nummy.HttpLogger.Extensions;</pre>
                        </DescriptionTemplate>
                    </Step>
                    <Step Title="Configure" Description="Add services in Program.cs">
                        <DescriptionTemplate>
                            <Text>Add the following configuration in your Program.cs:</Text>
                            <pre style="background: #f5f5f5; padding: 15px; border-radius: 4px; margin-top: 10px;">
builder.Services.AddNummyHttpLogger(options =>
                            {
                            options.ApplicationId = "@_application.Id";
                            options.LogRequestBody = true;
                            options.LogResponseBody = true;
                            });</pre>
                        </DescriptionTemplate>
                    </Step>
                    <Step Title="Middleware" Description="Add middleware in Program.cs">
                        <DescriptionTemplate>
                            <Text>Add the following middleware in your Program.cs after building the app:</Text>
                            <pre style="background: #f5f5f5; padding: 15px; border-radius: 4px; margin-top: 10px;">
var app = builder.Build();
app.UseNummyHttpLogger();</pre>
                        </DescriptionTemplate>
                    </Step>
                </StepsContent>
            </PackageCard>
        </GridRow>
    }
</Card>

@code {
    int ExceptionHandlerStep { get; set; } = 0;
    int CodeLoggerStep { get; set; } = 0;
    int HttpLoggerStep { get; set; } = 0;

    bool _showEx = false;
    bool _showCodeLogger = false;
    bool _showHttpLogger = false;

    void onExceptionHandlerStepChange(int current)
    {
        ExceptionHandlerStep = current;
    }

    void onCodeLoggerStepChange(int current)
    {
        CodeLoggerStep = current;
    }

    void onHttpLoggerStepChange(int current)
    {
        HttpLoggerStep = current;
    }

    async Task OnExceptionHandlerExpandedChanged(bool value)
    {
        _showEx = value;
        _showCodeLogger = false;
        _showHttpLogger = false;
    }

    async Task OnCodeLoggerExpandedChanged(bool value)
    {
        _showCodeLogger = value;
        _showEx = false;
        _showHttpLogger = false;
    }

    async Task OnHttpLoggerExpandedChanged(bool value)
    {
        _showHttpLogger = value;
        _showEx = false;
        _showCodeLogger = false;
    }
}